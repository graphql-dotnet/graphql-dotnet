# GQL023: AotSchema constructor must call Configure or chain to another constructor

|                        | Value   |
| ---------------------- | ------- |
| **Rule ID**            | GQL023  |
| **Category**           | Usage   |
| **Default severity**   | Warning |
| **Enabled by default** | Yes     |
| **Code fix provided**  | No      |
| **Introduced in**      | v9.0    |

## Cause

This rule is triggered when a constructor in a class deriving from `AotSchema` does
not either:
1. Call the `Configure()` method, or
2. Chain to another non-base constructor using `: this(...)`

## Rule description

The `AotSchema` class provides a `Configure()` method that should be called during
initialization to set up the schema. Every constructor in an `AotSchema`-derived
class should ensure that `Configure()` is eventually called, either directly or
by chaining to another constructor that calls it.

Failing to call `Configure()` means the schema may not be properly initialized,
which can lead to runtime errors or incomplete schema configuration.

## How to fix violations

Fix violations by either:
1. Adding a call to `Configure()` in the constructor body
2. Chaining to another constructor using `: this(...)` that eventually calls `Configure()`

## Example of a violation

### Constructor without Configure() call

```csharp
using GraphQL.Types;
using System;

public class MySchema : AotSchema
{
    // Warning: Constructor doesn't call Configure()
    public MySchema(IServiceProvider services) 
        : base(services, null!)
    {
        // Missing Configure() call
    }

    protected override void Configure()
    {
        // Schema configuration
    }
}
```

### Constructor not chaining to another constructor

```csharp
using GraphQL.Types;
using System;

public class MySchema : AotSchema
{
    // Warning: Constructor doesn't call Configure() or chain to another constructor
    public MySchema() : base(null!, null!)
    {
        // Missing Configure() call
    }

    public MySchema(bool initialize) : base(null!, null!)
    {
        Configure();  // This one calls Configure()
    }

    protected override void Configure()
    {
        // Schema configuration
    }
}
```

## Example of how to fix

### Fix by calling Configure() directly

```csharp
using GraphQL.Types;
using System;

public class MySchema : AotSchema
{
    // Fixed: Calls Configure() in the constructor
    public MySchema(IServiceProvider services) 
        : base(services, null!)
    {
        Configure();  // Added Configure() call
    }

    protected override void Configure()
    {
        // Schema configuration
    }
}
```

### Fix by chaining to another constructor

```csharp
using GraphQL.Types;
using System;

public class MySchema : AotSchema
{
    // Fixed: Chains to another constructor
    public MySchema() : this(null!)
    {
    }

    public MySchema(IServiceProvider services) 
        : base(services, null!)
    {
        Configure();
    }

    protected override void Configure()
    {
        // Schema configuration
    }
}
```

### Multiple constructor levels with proper chaining

```csharp
using GraphQL.Types;
using System;

public class MySchema : AotSchema
{
    // All constructors properly chain to the one that calls Configure()
    public MySchema() : this(null!)
    {
    }

    public MySchema(IServiceProvider services) : this(services, true)
    {
    }

    public MySchema(IServiceProvider services, bool initialize) 
        : base(services, null!)
    {
        Configure();  // Only the final constructor calls Configure()
    }

    protected override void Configure()
    {
        // Schema configuration
    }
}
```

## When to suppress warnings

You may suppress this warning if:
- You have a custom initialization pattern that doesn't follow the standard approach
- The schema is initialized through a different mechanism

However, be cautious when suppressing this warning as it can lead to runtime
configuration issues.

## Suppress a warning

If you just want to suppress a single violation, add preprocessor directives to
your source file to disable and then re-enable the rule.

```csharp
#pragma warning disable GQL023
// The code that's violating the rule is on this line.
#pragma warning restore GQL023
```

To disable the rule for a file, folder, or project, set its severity to `none` in the
[configuration file](https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/configuration-files).

```ini
[*.cs]
dotnet_diagnostic.GQL023.severity = none
```

For more information, see
[How to suppress code analysis warnings](https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/suppress-warnings).

## Related rules

- [GQL022](gql022.md) - AOT schema attributes must be applied to classes deriving from AotSchema
